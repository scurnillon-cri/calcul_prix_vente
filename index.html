<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Calculateur Le CRI</title>

    <style>
      :root {
        --cri-navy: #1d3557;
        --cri-blue: #3b82f6;
        --cri-bg: #f1f5f9;
        --cri-border: #e2e8f0;
        --text-dark: #0f172a;
        --input-bg: #f8fafc;
      }

      * {
        box-sizing: border-box;
        -webkit-font-smoothing: antialiased;
      }

      body {
        margin: 0;
        font-family: "Inter", system-ui, sans-serif;
        background: var(--cri-bg);
        color: var(--text-dark);
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px;
      }

      .main-header {
        width: 100%;
        max-width: 450px;
        background: var(--cri-navy);
        color: white;
        padding: 15px;
        border-radius: 12px 12px 0 0;
        text-align: center;
      }

      .main-header h1 {
        margin: 0;
        font-size: 1.1rem;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .container {
        width: 100%;
        max-width: 450px;
        background: white;
        border-radius: 0 0 12px 12px;
        padding: 15px 20px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }

      .section-title {
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--cri-navy);
        text-align: center;
        text-transform: uppercase;
        margin: 15px 0 10px 0;
        border-bottom: 1px solid var(--cri-bg);
        padding-bottom: 5px;
      }

      .row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 8px;
        gap: 10px;
      }

      label {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--text-dark);
        flex: 1;
      }

      .input-wrapper {
        position: relative;
        width: 120px;
        display: flex;
        align-items: center;
      }

      input,
      .result {
        width: 100%;
        padding: 8px 10px;
        text-align: right;
        border-radius: 6px;
        font-weight: 700;
        font-size: 0.9rem;
        border: 1px solid var(--cri-border);
      }

      input {
        background: var(--input-bg);
        color: var(--cri-navy);
      }

      .result-main {
        background: var(--cri-navy);
        color: white;
        border: none;
      }
      .result-soft {
        background: var(--cri-bg);
        color: var(--cri-navy);
        border: none;
      }

      /* Indicateurs de calcul (petits symboles) */
      .symbol {
        position: absolute;
        left: -18px;
        font-size: 10px;
        opacity: 0;
      }
      .symbol.active {
        opacity: 1;
      }
      .check {
        color: #22c55e;
      }
      .approx {
        color: #94a3b8;
      }

      .action-area {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        margin-top: 20px;
      }

      .btn {
        padding: 10px;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 700;
        cursor: pointer;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
      }

      .btn-share {
        background: #e2e8f0;
        color: var(--cri-navy);
      }
      .btn-send {
        background: var(--cri-blue);
        color: white;
      }

      .footer {
        margin-top: 15px;
        text-align: center;
        font-size: 0.7rem;
        opacity: 0.6;
      }
    </style>
  </head>

  <body>
    <div class="main-header">
      <h1>CALCULATEUR DE PRIX</h1>
    </div>

    <div class="container">
      <div class="section-title">üìä PRIX D'ANNONCE</div>

      <div class="row">
        <label>Prix d'achat HT</label>
        <div class="input-wrapper">
          <input type="text" id="achat" value="1000" inputmode="decimal" />
        </div>
      </div>

      <div class="row">
        <label>Marge (%)</label>
        <div class="input-wrapper">
          <span class="symbol check" id="checkMarge">‚úî</span>
          <input
            type="text"
            id="margeInput"
            placeholder="45"
            inputmode="decimal"
          />
        </div>
      </div>

      <div class="row">
        <label>Coef.</label>
        <div class="input-wrapper">
          <span class="symbol check" id="checkCoef">‚úî</span>
          <input
            type="text"
            id="coefInput"
            placeholder="1.82"
            inputmode="decimal"
          />
        </div>
      </div>

      <div class="row">
        <label>Prix d'annonce</label>
        <div class="input-wrapper">
          <div class="result result-main" id="prixAnnonce">0.00 ‚Ç¨</div>
        </div>
      </div>

      <div class="section-title">ü§ù N√âGOCIATION</div>

      <div class="row">
        <label>Remise (%)</label>
        <div class="input-wrapper">
          <input type="text" id="remise" value="10" inputmode="decimal" />
        </div>
      </div>

      <div class="section-title">üí∞ R√âSULTAT DE LA VENTE</div>

      <div class="row">
        <label>Marge (%)</label>
        <div class="input-wrapper">
          <div class="result result-soft" id="margeFinale">0 %</div>
        </div>
      </div>

      <div class="row">
        <label>Coef. r√©el</label>
        <div class="input-wrapper">
          <div class="result result-soft" id="coefFinal">0.00</div>
        </div>
      </div>

      <div class="row">
        <label>Prix de vente HT</label>
        <div class="input-wrapper">
          <div class="result result-main" id="prixVente">0.00 ‚Ç¨</div>
        </div>
      </div>

      <div class="action-area">
        <button class="btn btn-share" onclick="partagerOutil()">üîó Lien</button>
        <button class="btn btn-send" onclick="transmettreResultats()">
          üì§ Transmettre
        </button>
      </div>

      <div class="footer">
        <div class="footer-brand">üëâ Powered by Le CRI üëà</div>
        <span class="footer-sub">Le Club des Revendeurs Installateurs</span>
        <div class="footer-links">
          <a href="mailto:contact@cri-leclub.com">Contact</a>
          <a href="https://www.linkedin.com/company/cri-leclub/" target="_blank"
            >LinkedIn</a
          >
        </div>
      </div>
    </div>

    <script>
      let source = "marge";
      const el = {
        achat: document.getElementById("achat"),
        marge: document.getElementById("margeInput"),
        coef: document.getElementById("coefInput"),
        remise: document.getElementById("remise"),
        resAnnonce: document.getElementById("prixAnnonce"),
        resVente: document.getElementById("prixVente"),
        resMargeFinale: document.getElementById("margeFinale"),
        resCoefFinal: document.getElementById("coefFinal"),
        checkMarge: document.getElementById("checkMarge"),
        checkCoef: document.getElementById("checkCoef"),
      };

      function cleanValue(val) {
        let cleaned = val.replace(",", ".");
        return parseFloat(cleaned) || 0;
      }

      function updateUI(s) {
        source = s;
        el.checkMarge.classList.toggle("active", source === "marge");
        el.checkCoef.classList.toggle("active", source === "coef");
      }

      function calculer() {
        const achat = cleanValue(el.achat.value);
        const remise = cleanValue(el.remise.value);
        let margeInit = cleanValue(el.marge.value);
        let coefInit = cleanValue(el.coef.value);
        let coefExact = 1;

        if (source === "marge") {
          if (margeInit >= 100) margeInit = 99.99;
          coefExact = 1 / (1 - margeInit / 100);
          el.coef.value = coefExact.toFixed(2);
        } else {
          if (coefInit <= 0) coefInit = 1;
          coefExact = coefInit;
          margeInit = (1 - 1 / coefExact) * 100;
          el.marge.value = margeInit.toFixed(1);
        }

        const prixAnnonce = achat * coefExact;
        const prixVente = prixAnnonce * (1 - remise / 100);
        const margePctVente =
          prixVente > 0 ? ((prixVente - achat) / prixVente) * 100 : 0;
        const coefFinal = achat > 0 ? prixVente / achat : 0;

        const fmt = (v) =>
          v.toLocaleString("fr-FR", {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          }) + " ‚Ç¨";

        el.resAnnonce.textContent = fmt(prixAnnonce);
        el.resVente.textContent = fmt(prixVente);
        el.resMargeFinale.textContent = margePctVente.toFixed(1) + " %";
        el.resCoefFinal.textContent = coefFinal.toFixed(2);
      }

      function partagerOutil() {
        if (navigator.share) {
          navigator.share({ title: "Le CRI", url: window.location.href });
        } else {
          navigator.clipboard.writeText(window.location.href);
          alert("Lien copi√© !");
        }
      }

      async function transmettreResultats() {
        const text = `üìò *SIMULATION Le CRI*
---
üìä *ANNONCE*
‚Ä¢ Achat : ${el.achat.value}‚Ç¨ HT
‚Ä¢ Marge cible : ${el.marge.value}%
‚Ä¢ Coef : ${el.coef.value}
‚Ä¢ *PRIX CONSEILL√â : ${el.resAnnonce.textContent}*

üí∞ *VENTE (Remise ${el.remise.value}%)*
‚Ä¢ *PRIX FINAL : ${el.resVente.textContent}*
‚Ä¢ Marge r√©elle : ${el.resMargeFinale.textContent}
‚Ä¢ Coef r√©el : ${el.resCoefFinal.textContent}`;

        if (navigator.share) {
          try {
            await navigator.share({ title: "R√©sultats CRI", text: text });
          } catch (err) {
            copierTexte(text);
          }
        } else {
          copierTexte(text);
        }
      }

      function copierTexte(t) {
        navigator.clipboard.writeText(t);
        alert("Copi√© !");
      }

      [el.achat, el.marge, el.coef, el.remise].forEach((input) => {
        input.addEventListener("input", (e) => {
          if (e.target === el.marge) updateUI("marge");
          if (e.target === el.coef) updateUI("coef");
          calculer();
        });
      });

      el.marge.value = "45";
      updateUI("marge");
      calculer();
    </script>
  </body>
</html>
